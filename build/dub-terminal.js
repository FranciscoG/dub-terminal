!function(){"use strict";var e={},n=[],t=[];function o(o,r){var i,s,a,l,u=t;for(l=arguments.length;l-- >2;)n.push(arguments[l]);for(r&&null!=r.children&&(n.length||n.push(r.children),delete r.children);n.length;)if((s=n.pop())&&void 0!==s.pop)for(l=s.length;l--;)n.push(s[l]);else"boolean"==typeof s&&(s=null),(a="function"!=typeof o)&&(null==s?s="":"number"==typeof s?s=String(s):"string"!=typeof s&&(a=!1)),a&&i?u[u.length-1]+=s:u===t?u=[s]:u.push(s),i=a;var c=new function(){};return c.nodeName=o,c.children=u,c.attributes=null==r?void 0:r,c.key=null==r?void 0:r.key,void 0!==e.vnode&&e.vnode(c),c}function r(e,n){for(var t in n)e[t]=n[t];return e}var i="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,s=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,a=[];function l(n){!n._dirty&&(n._dirty=!0)&&1==a.push(n)&&(e.debounceRendering||i)(u)}function u(){var e,n=a;for(a=[];e=n.pop();)e._dirty&&P(e)}function c(e,n){return e.normalizedNodeName===n||e.nodeName.toLowerCase()===n.toLowerCase()}function p(e){var n=r({},e.attributes);n.children=e.children;var t=e.nodeName.defaultProps;if(void 0!==t)for(var o in t)void 0===n[o]&&(n[o]=t[o]);return n}function f(e){var n=e.parentNode;n&&n.removeChild(e)}function d(e,n,t,o,r){if("className"===n&&(n="class"),"key"===n);else if("ref"===n)t&&t(null),o&&o(e);else if("class"!==n||r)if("style"===n){if(o&&"string"!=typeof o&&"string"!=typeof t||(e.style.cssText=o||""),o&&"object"==typeof o){if("string"!=typeof t)for(var i in t)i in o||(e.style[i]="");for(var i in o)e.style[i]="number"==typeof o[i]&&!1===s.test(i)?o[i]+"px":o[i]}}else if("dangerouslySetInnerHTML"===n)o&&(e.innerHTML=o.__html||"");else if("o"==n[0]&&"n"==n[1]){var a=n!==(n=n.replace(/Capture$/,""));n=n.toLowerCase().substring(2),o?t||e.addEventListener(n,m,a):e.removeEventListener(n,m,a),(e._listeners||(e._listeners={}))[n]=o}else if("list"!==n&&"type"!==n&&!r&&n in e)!function(e,n,t){try{e[n]=t}catch(e){}}(e,n,null==o?"":o),null!=o&&!1!==o||e.removeAttribute(n);else{var l=r&&n!==(n=n.replace(/^xlink\:?/,""));null==o||!1===o?l?e.removeAttributeNS("http://www.w3.org/1999/xlink",n.toLowerCase()):e.removeAttribute(n):"function"!=typeof o&&(l?e.setAttributeNS("http://www.w3.org/1999/xlink",n.toLowerCase(),o):e.setAttribute(n,o))}else e.className=o||""}function m(n){return this._listeners[n.type](e.event&&e.event(n)||n)}var h=[],b=0,v=!1,g=!1;function _(){for(var n;n=h.pop();)e.afterMount&&e.afterMount(n),n.componentDidMount&&n.componentDidMount()}function y(e,n,t,o,r,i){b++||(v=null!=r&&void 0!==r.ownerSVGElement,g=null!=e&&!("__preactattr_"in e));var s=k(e,n,t,o,i);return r&&s.parentNode!==r&&r.appendChild(s),--b||(g=!1,i||_()),s}function k(e,n,t,o,r){var i=e,s=v;if(null!=n&&"boolean"!=typeof n||(n=""),"string"==typeof n||"number"==typeof n)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=n&&(e.nodeValue=n):(i=document.createTextNode(n),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),w(e,!0))),i.__preactattr_=!0,i;var a,l,u=n.nodeName;if("function"==typeof u)return function(e,n,t,o){var r=e&&e._component,i=r,s=e,a=r&&e._componentConstructor===n.nodeName,l=a,u=p(n);for(;r&&!l&&(r=r._parentComponent);)l=r.constructor===n.nodeName;r&&l&&(!o||r._component)?(O(r,u,3,t,o),e=r.base):(i&&!a&&(j(i),e=s=null),r=N(n.nodeName,u,t),e&&!r.nextBase&&(r.nextBase=e,s=null),O(r,u,1,t,o),e=r.base,s&&e!==s&&(s._component=null,w(s,!1)));return e}(e,n,t,o);if(v="svg"===u||"foreignObject"!==u&&v,u=String(u),(!e||!c(e,u))&&(a=u,(l=v?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a)).normalizedNodeName=a,i=l,e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),w(e,!0)}var m=i.firstChild,h=i.__preactattr_,b=n.children;if(null==h){h=i.__preactattr_={};for(var _=i.attributes,y=_.length;y--;)h[_[y].name]=_[y].value}return!g&&b&&1===b.length&&"string"==typeof b[0]&&null!=m&&void 0!==m.splitText&&null==m.nextSibling?m.nodeValue!=b[0]&&(m.nodeValue=b[0]):(b&&b.length||null!=m)&&function(e,n,t,o,r){var i,s,a,l,u,p=e.childNodes,d=[],m={},h=0,b=0,v=p.length,g=0,_=n?n.length:0;if(0!==v)for(var y=0;y<v;y++){var x=p[y],C=x.__preactattr_,N=_&&C?x._component?x._component.__key:C.key:null;null!=N?(h++,m[N]=x):(C||(void 0!==x.splitText?!r||x.nodeValue.trim():r))&&(d[g++]=x)}if(0!==_)for(var y=0;y<_;y++){l=n[y],u=null;var N=l.key;if(null!=N)h&&void 0!==m[N]&&(u=m[N],m[N]=void 0,h--);else if(!u&&b<g)for(i=b;i<g;i++)if(void 0!==d[i]&&(S=s=d[i],P=r,"string"==typeof(O=l)||"number"==typeof O?void 0!==S.splitText:"string"==typeof O.nodeName?!S._componentConstructor&&c(S,O.nodeName):P||S._componentConstructor===O.nodeName)){u=s,d[i]=void 0,i===g-1&&g--,i===b&&b++;break}u=k(u,l,t,o),a=p[y],u&&u!==e&&u!==a&&(null==a?e.appendChild(u):u===a.nextSibling?f(a):e.insertBefore(u,a))}var S,O,P;if(h)for(var y in m)void 0!==m[y]&&w(m[y],!1);for(;b<=g;)void 0!==(u=d[g--])&&w(u,!1)}(i,b,t,o,g||null!=h.dangerouslySetInnerHTML),function(e,n,t){var o;for(o in t)n&&null!=n[o]||null==t[o]||d(e,o,t[o],t[o]=void 0,v);for(o in n)"children"===o||"innerHTML"===o||o in t&&n[o]===("value"===o||"checked"===o?e[o]:t[o])||d(e,o,t[o],t[o]=n[o],v)}(i,n.attributes,h),v=s,i}function w(e,n){var t=e._component;t?j(t):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==n&&null!=e.__preactattr_||f(e),x(e))}function x(e){for(e=e.lastChild;e;){var n=e.previousSibling;w(e,!0),e=n}}var C={};function N(e,n,t){var o,r=C[e.name];if(e.prototype&&e.prototype.render?(o=new e(n,t),U.call(o,n,t)):((o=new U(n,t)).constructor=e,o.render=S),r)for(var i=r.length;i--;)if(r[i].constructor===e){o.nextBase=r[i].nextBase,r.splice(i,1);break}return o}function S(e,n,t){return this.constructor(e,t)}function O(n,t,o,r,i){n._disable||(n._disable=!0,(n.__ref=t.ref)&&delete t.ref,(n.__key=t.key)&&delete t.key,!n.base||i?n.componentWillMount&&n.componentWillMount():n.componentWillReceiveProps&&n.componentWillReceiveProps(t,r),r&&r!==n.context&&(n.prevContext||(n.prevContext=n.context),n.context=r),n.prevProps||(n.prevProps=n.props),n.props=t,n._disable=!1,0!==o&&(1!==o&&!1===e.syncComponentUpdates&&n.base?l(n):P(n,1,i)),n.__ref&&n.__ref(n))}function P(n,t,o,i){if(!n._disable){var s,a,l,u=n.props,c=n.state,f=n.context,d=n.prevProps||u,m=n.prevState||c,v=n.prevContext||f,g=n.base,k=n.nextBase,x=g||k,C=n._component,S=!1;if(g&&(n.props=d,n.state=m,n.context=v,2!==t&&n.shouldComponentUpdate&&!1===n.shouldComponentUpdate(u,c,f)?S=!0:n.componentWillUpdate&&n.componentWillUpdate(u,c,f),n.props=u,n.state=c,n.context=f),n.prevProps=n.prevState=n.prevContext=n.nextBase=null,n._dirty=!1,!S){s=n.render(u,c,f),n.getChildContext&&(f=r(r({},f),n.getChildContext()));var U,T,D=s&&s.nodeName;if("function"==typeof D){var z=p(s);(a=C)&&a.constructor===D&&z.key==a.__key?O(a,z,1,f,!1):(U=a,n._component=a=N(D,z,f),a.nextBase=a.nextBase||k,a._parentComponent=n,O(a,z,0,f,!1),P(a,1,o,!0)),T=a.base}else l=x,(U=C)&&(l=n._component=null),(x||1===t)&&(l&&(l._component=null),T=y(l,s,f,o||!g,x&&x.parentNode,!0));if(x&&T!==x&&a!==C){var A=x.parentNode;A&&T!==A&&(A.replaceChild(T,x),U||(x._component=null,w(x,!1)))}if(U&&j(U),n.base=T,T&&!i){for(var E=n,$=n;$=$._parentComponent;)(E=$).base=T;T._component=E,T._componentConstructor=E.constructor}}if(!g||o?h.unshift(n):S||(n.componentDidUpdate&&n.componentDidUpdate(d,m,v),e.afterUpdate&&e.afterUpdate(n)),null!=n._renderCallbacks)for(;n._renderCallbacks.length;)n._renderCallbacks.pop().call(n);b||i||_()}}function j(n){e.beforeUnmount&&e.beforeUnmount(n);var t=n.base;n._disable=!0,n.componentWillUnmount&&n.componentWillUnmount(),n.base=null;var o=n._component;o?j(o):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),n.nextBase=t,f(t),function(e){var n=e.constructor.name;(C[n]||(C[n]=[])).push(e)}(n),x(t)),n.__ref&&n.__ref(null)}function U(e,n){this._dirty=!0,this.context=n,this.props=e,this.state=this.state||{}}function T(e,n,t){return y(t,e,{},!1,n,!1)}function D(e){return e.thinking?o("p",{className:"dubterm-results__thinking"},"â–ˆ"):e.error?o("p",{className:"dubterm-results__error"},e.error):e.success?o("p",{className:"dubterm-results__success"},e.success):e.info?o("p",{className:"dubterm-results__info"},e.info):e.warning?o("p",{className:"dubterm-results__warning"},e.warning):null}r(U.prototype,{setState:function(e,n){var t=this.state;this.prevState||(this.prevState=r({},t)),r(t,"function"==typeof e?e(t,this.props):e),n&&(this._renderCallbacks=this._renderCallbacks||[]).push(n),l(this)},forceUpdate:function(e){e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),P(this,2)},render:function(){}});var z={command:"mute"};var A={command:"afk"};var E={command:"snooze"};var L={command:"unmute"};var M="https://api.dubtrack.fm/playlist";var B={fetch:function(){return new Promise(function(e,n){$.getJSON(M).fail(function(){n("error fetching playlists")}).done(function(t){t&&Array.isArray(t.data)?e(t.data):n("error fetching playlists")})})},add:function(e,n,t,o){var r=M+"/"+t+"/songs";return new Promise(function(t,i){$.post(r,{songid:o}).done(function(){t(e+" added to playlist "+n)}).fail(function(e){i("error saving to playlist")})})},new:function(e){return new Promise(function(n,t){$.post(M,{created:null,isPublic:!1,name:e,status:null,totalItems:0,userid:null}).done(function(o){console.log("create new playlist success",o),200===o.code?n("New playlist "+e+" created"):t("error creating playlist, check console for issues")}).fail(function(e){t("error creating playlist")})})}},W=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},F=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),V=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n},I=new function e(){var n=this;W(this,e),this.playlists={},this.listCount=0,this.currentSong=null,B.fetch().then(function(e){n.listCount=e.length,e.forEach(function(e){n.playlists[e.name]=e})}).catch(function(e){console.error(e)}),Dubtrack.room.player.activeSong.fetch().done(function(e){n.currentSong=e.data}),Dubtrack.Events.on("realtime:room_playlist-update",function(e){n.currentSong=e})},K={command:"grab"};var H={command:"playlists"};var R={mute:function(){var e=$(".mute"),n={};return e.hasClass("sound-muted")?(e.trigger("click"),n.success="mute OFF"):(e.trigger("click"),n.success="mute ON"),Promise.resolve(Object.assign({},z,n))},afk:function(e){return new Promise(function(n,t){dubplus||t("Dub+ extension not found. Please install it: https://dub.plus");var o={};if(e&&e.length>0)$("#dubplus-afk .extra-icon").trigger("click"),$(".dp-modal textarea").val(e.join(" ")),setTimeout(function(){$("#dp-modal-confirm").trigger("click")},500),o.success="new AFK message saved";else{var r=document.querySelector("#dubplus-afk.dubplus-switch-on"),i=dubplus["dubplus-afk"];r?(i.turnOff(),i.toggleAndSave("dubplus-afk",!1),o.success="AFK mode off"):(i.turnOn(),i.toggleAndSave("dubplus-afk",!0),o.success="AFK mode on")}n(Object.assign({},A,o))})},snooze:function(){var e=$(".snooze_btn"),n={};return $(".mute").hasClass("sound-muted")?n.warning="mute is already on. if you did not turn it on via snooze, unmute before snoozing":(e.trigger("click"),n.success="snooze current song ON"),Promise.resolve(Object.assign({},E,n))},unmute:function(){var e=$(".mute"),n={};return new Promise(function(t,o){e.hasClass("sound-muted")?(e.trigger("click"),n.success="mute OFF",t(Object.assign({},L,n))):o("mute is not on")})},grab:function(e){var n={};if(!e)return Promise.reject("you must specify a playlist name");var t=e.join(" ").trim(),o=I.playlists[t],r=I.currentSong;if(o){var i=o._id,s=r.songInfo._id,a=r.songInfo.name;return new Promise(function(e,o){B.add(a,t,i,s).then(function(t){n.success=t,e(Object.assign({},K,n))}).catch(function(e){o(e)})})}return Promise.reject("playlist "+t+" does not exist")},playlists:function(e){return e&&e.length>0?new Promise(function(n,t){B.new(e.join(" ").trim()).then(function(e){n(Object.assign({},H,{success:e}))}).catch(function(e){t(e)})}):new Promise(function(e,n){B.fetch().then(function(n){var t=n.map(function(e){return e.name});e(Object.assign({},H,{success:t.sort().join(", ")}))}).catch(function(e){n(e)})})}},q=new(function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;W(this,e),this._history=[],this._index=0,this._limit=n}return F(e,[{key:"forward",value:function(){return this._history.length>0?(this._index<this._history.length-1&&this._index++,this._history[this._index]):""}},{key:"back",value:function(){var e="";return this._history.length>0&&(e=this._history[this._index],this._index>0&&this._index--),e}},{key:"insert",value:function(e){this._history.push(e),this._history.length>30&&this._history.shift(),this._index=this._history.length-1}}]),e}()),G=function(e){function n(){W(this,n);var e=V(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.state={toggleOpen:"dubterm-open",result:{info:"hi "+Dubtrack.session.get("username")+"!"}},e.toggleTerminal=e.toggleTerminal.bind(e),e.keyUp=e.keyUp.bind(e),e.keyDown=e.keyDown.bind(e),e}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,U),F(n,[{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.setState({toggleOpen:""})},1500)}},{key:"toggleTerminal",value:function(e){"dubterm-open"===this.state.toggleOpen?this.setState({toggleOpen:""}):this.setState({toggleOpen:"dubterm-open"})}},{key:"checkCommands",value:function(e,n){return R[e]?R[e](n):Promise.reject(e+" is not a recognized command")}},{key:"onEnter",value:function(e){var n=this;q.insert(e);var t=e.split(" "),o=t.shift();"clear"!==o?this.checkCommands(o,t).then(function(e){n.setState({result:e})}).catch(function(e){n.setState({result:{error:e}})}):this.setState({result:null})}},{key:"onUp",value:function(e){e.target.value=q.back()}},{key:"onDown",value:function(e){e.target.value=q.forward()}},{key:"keyDown",value:function(e){38===e.keyCode&&(e.preventDefault(),this.onUp(e)),40===e.keyCode&&(e.preventDefault(),this.onDown(e))}},{key:"keyUp",value:function(e){if(13===e.keyCode){if(e.preventDefault(),""===e.target.value)return;return this.setState({result:{thinking:!0}}),this.onEnter(e.target.value),void(e.target.value="")}}},{key:"render",value:function(e,n){var t=this;return o("div",{id:"dub-terminal",className:("dubterm-container "+n.toggleOpen).trim()},o("div",{className:"dubterm-main"},o("div",{className:"dubterm-results",ref:function(e){return t.results=e}},o(D,n.result)),o("div",{className:"dubterm-input-c"},o("input",{onKeyUp:this.keyUp,onKeyDown:this.keyDown,type:"text",id:"dubterm-input"}),o("span",null,">"))),o("button",{onClick:this.toggleTerminal,className:"dubterm-toggle"},o("span",null,">_")))}}]),n}();T(o("style",{id:"dub-terminal-css"},'.dubterm-container {\n  position: fixed;\n  left: 0;\n  bottom: 56px;\n  bottom: 3.6rem;\n  z-index: 18;\n  width: 500px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n  color: #839496;\n  -webkit-transition: -webkit-transform 0.3s;\n  transition: -webkit-transform 0.3s;\n  transition: transform 0.3s;\n  transition: transform 0.3s, -webkit-transform 0.3s;\n  -webkit-transform: translate(-460px, 0);\n          transform: translate(-460px, 0);\n  height: 80px; }\n\n.dubterm-open {\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0); }\n\n.dubterm-toggle {\n  width: 50px;\n  height: 40px;\n  border: none;\n  background-color: #000;\n  cursor: pointer;\n  -ms-flex-item-align: end;\n      align-self: flex-end; }\n\n.dubterm-main {\n  -webkit-box-flex: 1;\n      -ms-flex: 1 0 auto;\n          flex: 1 0 auto;\n  background-color: #002b36;\n  font-family: Consolas, monaco, monospace, "Courier New";\n  font-size: 13px;\n  position: relative; }\n\n.dubterm-results {\n  padding: 11px 18px;\n  background-color: #073642;\n  min-height: 40px;\n  width: 100%;\n  overflow: hidden;\n  overflow-y: auto;\n  border-top: 1px solid #93a1a1;\n  border-right: 1px solid #93a1a1;\n  border-bottom: 1px solid #93a1a1;\n  position: absolute;\n  bottom: 40px; }\n  .dubterm-results p {\n    margin: 0; }\n\n.dubterm-results__error {\n  color: #dc322f; }\n\n.dubterm-results__success {\n  color: #2aa198; }\n\n.dubterm-results__warning {\n  color: #b58900; }\n\n.dubterm-results__thinking {\n  -webkit-animation: 1s blink step-end infinite;\n          animation: 1s blink step-end infinite;\n  will-change: color; }\n\n@-webkit-keyframes blink {\n  from, to {\n    color: inherit; }\n  50% {\n    color: transparent; } }\n\n@keyframes blink {\n  from, to {\n    color: inherit; }\n  50% {\n    color: transparent; } }\n\n/* The input container */\n.dubterm-input-c {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  height: 40px; }\n\n.dubterm-input-c span {\n  position: absolute;\n  width: 10px;\n  left: 10px;\n  top: 10px;\n  display: block;\n  height: 100%; }\n\n.dubterm-input-c input {\n  border: none;\n  width: 100%;\n  height: 100%;\n  background-color: black;\n  color: #ccc;\n  font-family: Consolas, monaco, monospace, "Courier New";\n  font-size: 13px;\n  padding: 0 0 0 20px; }\n'),document.querySelector("head")),T(o(G,null),document.body)}();
//# sourceMappingURL=dub-terminal.js.map
