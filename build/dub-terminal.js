!function(){"use strict";var e={},t=[],n=[];function o(o,r){var i,s,a,l,u=n;for(l=arguments.length;l-- >2;)t.push(arguments[l]);for(r&&null!=r.children&&(t.length||t.push(r.children),delete r.children);t.length;)if((s=t.pop())&&void 0!==s.pop)for(l=s.length;l--;)t.push(s[l]);else"boolean"==typeof s&&(s=null),(a="function"!=typeof o)&&(null==s?s="":"number"==typeof s?s=String(s):"string"!=typeof s&&(a=!1)),a&&i?u[u.length-1]+=s:u===n?u=[s]:u.push(s),i=a;var c=new function(){};return c.nodeName=o,c.children=u,c.attributes=null==r?void 0:r,c.key=null==r?void 0:r.key,void 0!==e.vnode&&e.vnode(c),c}function r(e,t){for(var n in t)e[n]=t[n];return e}var i="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,s=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,a=[];function l(t){!t._dirty&&(t._dirty=!0)&&1==a.push(t)&&(e.debounceRendering||i)(u)}function u(){var e,t=a;for(a=[];e=t.pop();)e._dirty&&P(e)}function c(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function p(e){var t=r({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var o in n)void 0===t[o]&&(t[o]=n[o]);return t}function f(e){var t=e.parentNode;t&&t.removeChild(e)}function d(e,t,n,o,r){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n&&n(null),o&&o(e);else if("class"!==t||r)if("style"===t){if(o&&"string"!=typeof o&&"string"!=typeof n||(e.style.cssText=o||""),o&&"object"==typeof o){if("string"!=typeof n)for(var i in n)i in o||(e.style[i]="");for(var i in o)e.style[i]="number"==typeof o[i]&&!1===s.test(i)?o[i]+"px":o[i]}}else if("dangerouslySetInnerHTML"===t)o&&(e.innerHTML=o.__html||"");else if("o"==t[0]&&"n"==t[1]){var a=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),o?n||e.addEventListener(t,m,a):e.removeEventListener(t,m,a),(e._listeners||(e._listeners={}))[t]=o}else if("list"!==t&&"type"!==t&&!r&&t in e)!function(e,t,n){try{e[t]=n}catch(e){}}(e,t,null==o?"":o),null!=o&&!1!==o||e.removeAttribute(t);else{var l=r&&t!==(t=t.replace(/^xlink\:?/,""));null==o||!1===o?l?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof o&&(l?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),o):e.setAttribute(t,o))}else e.className=o||""}function m(t){return this._listeners[t.type](e.event&&e.event(t)||t)}var h=[],b=0,v=!1,g=!1;function y(){for(var t;t=h.pop();)e.afterMount&&e.afterMount(t),t.componentDidMount&&t.componentDidMount()}function _(e,t,n,o,r,i){b++||(v=null!=r&&void 0!==r.ownerSVGElement,g=null!=e&&!("__preactattr_"in e));var s=k(e,t,n,o,i);return r&&s.parentNode!==r&&r.appendChild(s),--b||(g=!1,i||y()),s}function k(e,t,n,o,r){var i=e,s=v;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),x(e,!0))),i.__preactattr_=!0,i;var a,l,u=t.nodeName;if("function"==typeof u)return function(e,t,n,o){var r=e&&e._component,i=r,s=e,a=r&&e._componentConstructor===t.nodeName,l=a,u=p(t);for(;r&&!l&&(r=r._parentComponent);)l=r.constructor===t.nodeName;r&&l&&(!o||r._component)?(O(r,u,3,n,o),e=r.base):(i&&!a&&(j(i),e=s=null),r=N(t.nodeName,u,n),e&&!r.nextBase&&(r.nextBase=e,s=null),O(r,u,1,n,o),e=r.base,s&&e!==s&&(s._component=null,x(s,!1)));return e}(e,t,n,o);if(v="svg"===u||"foreignObject"!==u&&v,u=String(u),(!e||!c(e,u))&&(a=u,(l=v?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a)).normalizedNodeName=a,i=l,e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),x(e,!0)}var m=i.firstChild,h=i.__preactattr_,b=t.children;if(null==h){h=i.__preactattr_={};for(var y=i.attributes,_=y.length;_--;)h[y[_].name]=y[_].value}return!g&&b&&1===b.length&&"string"==typeof b[0]&&null!=m&&void 0!==m.splitText&&null==m.nextSibling?m.nodeValue!=b[0]&&(m.nodeValue=b[0]):(b&&b.length||null!=m)&&function(e,t,n,o,r){var i,s,a,l,u,p=e.childNodes,d=[],m={},h=0,b=0,v=p.length,g=0,y=t?t.length:0;if(0!==v)for(var _=0;_<v;_++){var w=p[_],C=w.__preactattr_,N=y&&C?w._component?w._component.__key:C.key:null;null!=N?(h++,m[N]=w):(C||(void 0!==w.splitText?!r||w.nodeValue.trim():r))&&(d[g++]=w)}if(0!==y)for(var _=0;_<y;_++){l=t[_],u=null;var N=l.key;if(null!=N)h&&void 0!==m[N]&&(u=m[N],m[N]=void 0,h--);else if(!u&&b<g)for(i=b;i<g;i++)if(void 0!==d[i]&&(S=s=d[i],P=r,"string"==typeof(O=l)||"number"==typeof O?void 0!==S.splitText:"string"==typeof O.nodeName?!S._componentConstructor&&c(S,O.nodeName):P||S._componentConstructor===O.nodeName)){u=s,d[i]=void 0,i===g-1&&g--,i===b&&b++;break}u=k(u,l,n,o),a=p[_],u&&u!==e&&u!==a&&(null==a?e.appendChild(u):u===a.nextSibling?f(a):e.insertBefore(u,a))}var S,O,P;if(h)for(var _ in m)void 0!==m[_]&&x(m[_],!1);for(;b<=g;)void 0!==(u=d[g--])&&x(u,!1)}(i,b,n,o,g||null!=h.dangerouslySetInnerHTML),function(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||d(e,o,n[o],n[o]=void 0,v);for(o in t)"children"===o||"innerHTML"===o||o in n&&t[o]===("value"===o||"checked"===o?e[o]:n[o])||d(e,o,n[o],n[o]=t[o],v)}(i,t.attributes,h),v=s,i}function x(e,t){var n=e._component;n?j(n):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==t&&null!=e.__preactattr_||f(e),w(e))}function w(e){for(e=e.lastChild;e;){var t=e.previousSibling;x(e,!0),e=t}}var C={};function N(e,t,n){var o,r=C[e.name];if(e.prototype&&e.prototype.render?(o=new e(t,n),U.call(o,t,n)):((o=new U(t,n)).constructor=e,o.render=S),r)for(var i=r.length;i--;)if(r[i].constructor===e){o.nextBase=r[i].nextBase,r.splice(i,1);break}return o}function S(e,t,n){return this.constructor(e,n)}function O(t,n,o,r,i){t._disable||(t._disable=!0,(t.__ref=n.ref)&&delete n.ref,(t.__key=n.key)&&delete n.key,!t.base||i?t.componentWillMount&&t.componentWillMount():t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),r&&r!==t.context&&(t.prevContext||(t.prevContext=t.context),t.context=r),t.prevProps||(t.prevProps=t.props),t.props=n,t._disable=!1,0!==o&&(1!==o&&!1===e.syncComponentUpdates&&t.base?l(t):P(t,1,i)),t.__ref&&t.__ref(t))}function P(t,n,o,i){if(!t._disable){var s,a,l,u=t.props,c=t.state,f=t.context,d=t.prevProps||u,m=t.prevState||c,v=t.prevContext||f,g=t.base,k=t.nextBase,w=g||k,C=t._component,S=!1;if(g&&(t.props=d,t.state=m,t.context=v,2!==n&&t.shouldComponentUpdate&&!1===t.shouldComponentUpdate(u,c,f)?S=!0:t.componentWillUpdate&&t.componentWillUpdate(u,c,f),t.props=u,t.state=c,t.context=f),t.prevProps=t.prevState=t.prevContext=t.nextBase=null,t._dirty=!1,!S){s=t.render(u,c,f),t.getChildContext&&(f=r(r({},f),t.getChildContext()));var U,T,D=s&&s.nodeName;if("function"==typeof D){var z=p(s);(a=C)&&a.constructor===D&&z.key==a.__key?O(a,z,1,f,!1):(U=a,t._component=a=N(D,z,f),a.nextBase=a.nextBase||k,a._parentComponent=t,O(a,z,0,f,!1),P(a,1,o,!0)),T=a.base}else l=w,(U=C)&&(l=t._component=null),(w||1===n)&&(l&&(l._component=null),T=_(l,s,f,o||!g,w&&w.parentNode,!0));if(w&&T!==w&&a!==C){var I=w.parentNode;I&&T!==I&&(I.replaceChild(T,w),U||(w._component=null,x(w,!1)))}if(U&&j(U),t.base=T,T&&!i){for(var A=t,E=t;E=E._parentComponent;)(A=E).base=T;T._component=A,T._componentConstructor=A.constructor}}if(!g||o?h.unshift(t):S||(t.componentDidUpdate&&t.componentDidUpdate(d,m,v),e.afterUpdate&&e.afterUpdate(t)),null!=t._renderCallbacks)for(;t._renderCallbacks.length;)t._renderCallbacks.pop().call(t);b||i||y()}}function j(t){e.beforeUnmount&&e.beforeUnmount(t);var n=t.base;t._disable=!0,t.componentWillUnmount&&t.componentWillUnmount(),t.base=null;var o=t._component;o?j(o):n&&(n.__preactattr_&&n.__preactattr_.ref&&n.__preactattr_.ref(null),t.nextBase=n,f(n),function(e){var t=e.constructor.name;(C[t]||(C[t]=[])).push(e)}(t),w(n)),t.__ref&&t.__ref(null)}function U(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{}}function T(e,t,n){return _(n,e,{},!1,t,!1)}function D(e){return e.thinking?o("p",{className:"dubterm-results__thinking"},"â–ˆ"):e.error?o("p",{className:"dubterm-results__error"},e.error):e.success?o("p",{className:"dubterm-results__success"},e.success):e.info?o("p",{className:"dubterm-results__info"},e.info):e.warning?o("p",{className:"dubterm-results__warning"},e.warning):null}r(U.prototype,{setState:function(e,t){var n=this.state;this.prevState||(this.prevState=r({},n)),r(n,"function"==typeof e?e(n,this.props):e),t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),l(this)},forceUpdate:function(e){e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),P(this,2)},render:function(){}});var z={command:"mute"};var I={command:"afk"};var A={command:"snooze"};var E={command:"unmute"};var L="https://api.dubtrack.fm/playlist";var M={fetch:function(){return new Promise(function(e,t){$.getJSON(L).fail(function(){t("error fetching playlists")}).done(function(n){n&&Array.isArray(n.data)?e(n.data):t("error fetching playlists")})})},add:function(e,t,n,o){var r=L+"/"+n+"/songs";return new Promise(function(n,i){$.post(r,{songid:o}).done(function(){n(e+" added to playlist "+t)}).fail(function(e){i("error saving to playlist")})})},new:function(e){return new Promise(function(t,n){$.post(L,{created:null,isPublic:!1,name:e,status:null,totalItems:0,userid:null}).done(function(o){console.log("create new playlist success",o),200===o.code?t("New playlist "+e+" created"):n("error creating playlist, check console for issues")}).fail(function(e){n("error creating playlist")})})}},B=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},W=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),F=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},H=new function e(){var t=this;B(this,e),this.playlists={},this.listCount=0,this.currentSong=null,M.fetch().then(function(e){t.listCount=e.length,e.forEach(function(e){t.playlists[e.name]=e})}).catch(function(e){console.error(e)}),Dubtrack.room.player.activeSong.fetch().done(function(e){t.currentSong=e.data}),Dubtrack.Events.on("realtime:room_playlist-update",function(e){t.currentSong=e})},V={command:"grab"};var K={command:"playlists"};var R={mute:function(){var e=$(".mute"),t={};return e.hasClass("sound-muted")?(e.trigger("click"),t.success="mute OFF"):(e.trigger("click"),t.success="mute ON"),Promise.resolve(Object.assign({},z,t))},afk:function(e){return new Promise(function(t,n){dubplus||n("Dub+ extension not found. Please install it: https://dub.plus");var o={};if(e&&e.length>0)$("#dubplus-afk .extra-icon").trigger("click"),$(".dp-modal textarea").val(e.join(" ")),setTimeout(function(){$("#dp-modal-confirm").trigger("click")},500),o.success="new AFK message saved";else{var r=document.querySelector("#dubplus-afk.dubplus-switch-on"),i=dubplus["dubplus-afk"];r?(i.turnOff(),i.toggleAndSave("dubplus-afk",!1),o.success="AFK mode off"):(i.turnOn(),i.toggleAndSave("dubplus-afk",!0),o.success="AFK mode on")}t(Object.assign({},I,o))})},snooze:function(){var e=$(".snooze_btn"),t={};return $(".mute").hasClass("sound-muted")?t.warning="mute is already on. if you did not turn it on via snooze, unmute before snoozing":(e.trigger("click"),t.success="snooze current song ON"),Promise.resolve(Object.assign({},A,t))},unmute:function(){var e=$(".mute"),t={};return new Promise(function(n,o){e.hasClass("sound-muted")?(e.trigger("click"),t.success="mute OFF",n(Object.assign({},E,t))):o("mute is not on")})},grab:function(e){var t={};if(!e)return Promise.reject("you must specify a playlist name");var n=e.join(" ").trim(),o=H.playlists[n],r=H.currentSong;if(o){var i=o._id,s=r.songInfo._id,a=r.songInfo.name;return new Promise(function(e,o){M.add(a,n,i,s).then(function(n){t.success=n,e(Object.assign({},V,t))}).catch(function(e){o(e)})})}return Promise.reject("playlist "+n+" does not exist")},playlists:function(e){return e&&e.length>0?new Promise(function(t,n){M.new(e.join(" ").trim()).then(function(e){t(Object.assign({},K,{success:e}))}).catch(function(e){n(e)})}):new Promise(function(e,t){M.fetch().then(function(t){var n=t.map(function(e){return e.name});e(Object.assign({},K,{success:n.sort().join(", ")}))}).catch(function(e){t(e)})})}},q=function(e){function t(){B(this,t);var e=F(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.history=[],e.historyIndex=0,e.state={toggleOpen:"dubterm-open",result:{info:"hi "+Dubtrack.session.get("username")+"!"}},e.toggleTerminal=e.toggleTerminal.bind(e),e.keyUp=e.keyUp.bind(e),e.keyDown=e.keyDown.bind(e),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,U),W(t,[{key:"updateHistory",value:function(e){this.history.push(e),this.history.length>30&&this.history.shift(),this.historyIndex=this.history.length-1}},{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.setState({toggleOpen:""})},1500)}},{key:"toggleTerminal",value:function(e){"dubterm-open"===this.state.toggleOpen?this.setState({toggleOpen:""}):this.setState({toggleOpen:"dubterm-open"})}},{key:"checkCommands",value:function(e,t){return R[e]?R[e](t):Promise.reject(e+" is not a recognized command")}},{key:"onEnter",value:function(e){var t=this,n=e.split(" "),o=n.shift();"clear"!==o?this.checkCommands(o,n).then(function(e){t.setState({result:e})}).catch(function(e){t.setState({result:{error:e}})}):this.setState({result:null})}},{key:"onUp",value:function(e){this.history.length>0&&(e.target.value=this.history[this.historyIndex],this.historyIndex>0&&this.historyIndex--)}},{key:"onDown",value:function(e){this.history.length>0&&(this.historyIndex<this.history.length-1&&this.historyIndex++,e.target.value=this.history[this.historyIndex])}},{key:"keyDown",value:function(e){38===e.keyCode&&(e.preventDefault(),this.onUp(e)),40===e.keyCode&&(e.preventDefault(),this.onDown(e))}},{key:"keyUp",value:function(e){if(13===e.keyCode){if(e.preventDefault(),""===e.target.value)return;return this.setState({result:{thinking:!0}}),this.updateHistory(e.target.value),this.onEnter(e.target.value),void(e.target.value="")}}},{key:"render",value:function(e,t){var n=this;return o("div",{id:"dub-terminal",className:("dubterm-container "+t.toggleOpen).trim()},o("div",{className:"dubterm-main"},o("div",{className:"dubterm-results",ref:function(e){return n.results=e}},o(D,t.result)),o("div",{className:"dubterm-input-c"},o("input",{onKeyUp:this.keyUp,onKeyDown:this.keyDown,type:"text",id:"dubterm-input"}),o("span",null,">"))),o("button",{onClick:this.toggleTerminal,className:"dubterm-toggle"},o("span",null,">_")))}}]),t}();T(o("style",{id:"dub-terminal-css"},'.dubterm-container {\n  position: fixed;\n  left: 0;\n  bottom: 56px;\n  bottom: 3.6rem;\n  z-index: 18;\n  width: 500px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n  color: #839496;\n  -webkit-transition: -webkit-transform 0.3s;\n  transition: -webkit-transform 0.3s;\n  transition: transform 0.3s;\n  transition: transform 0.3s, -webkit-transform 0.3s;\n  -webkit-transform: translate(-460px, 0);\n          transform: translate(-460px, 0);\n  height: 80px; }\n\n.dubterm-open {\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0); }\n\n.dubterm-toggle {\n  width: 50px;\n  height: 40px;\n  border: none;\n  background-color: #000;\n  cursor: pointer;\n  -ms-flex-item-align: end;\n      align-self: flex-end; }\n\n.dubterm-main {\n  -webkit-box-flex: 1;\n      -ms-flex: 1 0 auto;\n          flex: 1 0 auto;\n  background-color: #002b36;\n  font-family: Consolas, monaco, monospace, "Courier New";\n  font-size: 13px;\n  position: relative; }\n\n.dubterm-results {\n  padding: 11px 18px;\n  background-color: #073642;\n  min-height: 40px;\n  width: 100%;\n  overflow: hidden;\n  overflow-y: auto;\n  border-top: 1px solid #93a1a1;\n  border-right: 1px solid #93a1a1;\n  border-bottom: 1px solid #93a1a1;\n  position: absolute;\n  bottom: 40px; }\n  .dubterm-results p {\n    margin: 0; }\n\n.dubterm-results__error {\n  color: #dc322f; }\n\n.dubterm-results__success {\n  color: #2aa198; }\n\n.dubterm-results__warning {\n  color: #b58900; }\n\n.dubterm-results__thinking {\n  -webkit-animation: 1s blink step-end infinite;\n          animation: 1s blink step-end infinite; }\n\n@-webkit-keyframes blink {\n  from, to {\n    color: inherit; }\n  50% {\n    color: #073642; } }\n\n@keyframes blink {\n  from, to {\n    color: inherit; }\n  50% {\n    color: #073642; } }\n\n/* The input container */\n.dubterm-input-c {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  height: 40px; }\n\n.dubterm-input-c span {\n  position: absolute;\n  width: 10px;\n  left: 10px;\n  top: 10px;\n  display: block;\n  height: 100%; }\n\n.dubterm-input-c input {\n  border: none;\n  width: 100%;\n  height: 100%;\n  background-color: black;\n  color: #ccc;\n  font-family: Consolas, monaco, monospace, "Courier New";\n  font-size: 13px;\n  padding: 0 0 0 20px; }\n'),document.querySelector("head")),T(o(q,null),document.body)}();
//# sourceMappingURL=dub-terminal.js.map
