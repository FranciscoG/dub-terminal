!function(){"use strict";var e={},n=[],t=[];function o(o,r){var i,s,a,l,u=t;for(l=arguments.length;l-- >2;)n.push(arguments[l]);for(r&&null!=r.children&&(n.length||n.push(r.children),delete r.children);n.length;)if((s=n.pop())&&void 0!==s.pop)for(l=s.length;l--;)n.push(s[l]);else"boolean"==typeof s&&(s=null),(a="function"!=typeof o)&&(null==s?s="":"number"==typeof s?s=String(s):"string"!=typeof s&&(a=!1)),a&&i?u[u.length-1]+=s:u===t?u=[s]:u.push(s),i=a;var c=new function(){};return c.nodeName=o,c.children=u,c.attributes=null==r?void 0:r,c.key=null==r?void 0:r.key,void 0!==e.vnode&&e.vnode(c),c}function r(e,n){for(var t in n)e[t]=n[t];return e}var i="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,s=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,a=[];function l(n){!n._dirty&&(n._dirty=!0)&&1==a.push(n)&&(e.debounceRendering||i)(u)}function u(){var e,n=a;for(a=[];e=n.pop();)e._dirty&&T(e)}function c(e,n){return e.normalizedNodeName===n||e.nodeName.toLowerCase()===n.toLowerCase()}function p(e){var n=r({},e.attributes);n.children=e.children;var t=e.nodeName.defaultProps;if(void 0!==t)for(var o in t)void 0===n[o]&&(n[o]=t[o]);return n}function d(e){var n=e.parentNode;n&&n.removeChild(e)}function f(e,n,t,o,r){if("className"===n&&(n="class"),"key"===n);else if("ref"===n)t&&t(null),o&&o(e);else if("class"!==n||r)if("style"===n){if(o&&"string"!=typeof o&&"string"!=typeof t||(e.style.cssText=o||""),o&&"object"==typeof o){if("string"!=typeof t)for(var i in t)i in o||(e.style[i]="");for(var i in o)e.style[i]="number"==typeof o[i]&&!1===s.test(i)?o[i]+"px":o[i]}}else if("dangerouslySetInnerHTML"===n)o&&(e.innerHTML=o.__html||"");else if("o"==n[0]&&"n"==n[1]){var a=n!==(n=n.replace(/Capture$/,""));n=n.toLowerCase().substring(2),o?t||e.addEventListener(n,m,a):e.removeEventListener(n,m,a),(e._listeners||(e._listeners={}))[n]=o}else if("list"!==n&&"type"!==n&&!r&&n in e)!function(e,n,t){try{e[n]=t}catch(e){}}(e,n,null==o?"":o),null!=o&&!1!==o||e.removeAttribute(n);else{var l=r&&n!==(n=n.replace(/^xlink\:?/,""));null==o||!1===o?l?e.removeAttributeNS("http://www.w3.org/1999/xlink",n.toLowerCase()):e.removeAttribute(n):"function"!=typeof o&&(l?e.setAttributeNS("http://www.w3.org/1999/xlink",n.toLowerCase(),o):e.setAttribute(n,o))}else e.className=o||""}function m(n){return this._listeners[n.type](e.event&&e.event(n)||n)}var b=[],h=0,v=!1,g=!1;function _(){for(var n;n=b.pop();)e.afterMount&&e.afterMount(n),n.componentDidMount&&n.componentDidMount()}function y(e,n,t,o,r,i){h++||(v=null!=r&&void 0!==r.ownerSVGElement,g=null!=e&&!("__preactattr_"in e));var s=x(e,n,t,o,i);return r&&s.parentNode!==r&&r.appendChild(s),--h||(g=!1,i||_()),s}function x(e,n,t,o,r){var i=e,s=v;if(null!=n&&"boolean"!=typeof n||(n=""),"string"==typeof n||"number"==typeof n)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=n&&(e.nodeValue=n):(i=document.createTextNode(n),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),k(e,!0))),i.__preactattr_=!0,i;var a,l,u=n.nodeName;if("function"==typeof u)return function(e,n,t,o){var r=e&&e._component,i=r,s=e,a=r&&e._componentConstructor===n.nodeName,l=a,u=p(n);for(;r&&!l&&(r=r._parentComponent);)l=r.constructor===n.nodeName;r&&l&&(!o||r._component)?(P(r,u,3,t,o),e=r.base):(i&&!a&&(O(i),e=s=null),r=N(n.nodeName,u,t),e&&!r.nextBase&&(r.nextBase=e,s=null),P(r,u,1,t,o),e=r.base,s&&e!==s&&(s._component=null,k(s,!1)));return e}(e,n,t,o);if(v="svg"===u||"foreignObject"!==u&&v,u=String(u),(!e||!c(e,u))&&(a=u,(l=v?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a)).normalizedNodeName=a,i=l,e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),k(e,!0)}var m=i.firstChild,b=i.__preactattr_,h=n.children;if(null==b){b=i.__preactattr_={};for(var _=i.attributes,y=_.length;y--;)b[_[y].name]=_[y].value}return!g&&h&&1===h.length&&"string"==typeof h[0]&&null!=m&&void 0!==m.splitText&&null==m.nextSibling?m.nodeValue!=h[0]&&(m.nodeValue=h[0]):(h&&h.length||null!=m)&&function(e,n,t,o,r){var i,s,a,l,u,p=e.childNodes,f=[],m={},b=0,h=0,v=p.length,g=0,_=n?n.length:0;if(0!==v)for(var y=0;y<v;y++){var w=p[y],C=w.__preactattr_,N=_&&C?w._component?w._component.__key:C.key:null;null!=N?(b++,m[N]=w):(C||(void 0!==w.splitText?!r||w.nodeValue.trim():r))&&(f[g++]=w)}if(0!==_)for(var y=0;y<_;y++){l=n[y],u=null;var N=l.key;if(null!=N)b&&void 0!==m[N]&&(u=m[N],m[N]=void 0,b--);else if(!u&&h<g)for(i=h;i<g;i++)if(void 0!==f[i]&&(S=s=f[i],T=r,"string"==typeof(P=l)||"number"==typeof P?void 0!==S.splitText:"string"==typeof P.nodeName?!S._componentConstructor&&c(S,P.nodeName):T||S._componentConstructor===P.nodeName)){u=s,f[i]=void 0,i===g-1&&g--,i===h&&h++;break}u=x(u,l,t,o),a=p[y],u&&u!==e&&u!==a&&(null==a?e.appendChild(u):u===a.nextSibling?d(a):e.insertBefore(u,a))}var S,P,T;if(b)for(var y in m)void 0!==m[y]&&k(m[y],!1);for(;h<=g;)void 0!==(u=f[g--])&&k(u,!1)}(i,h,t,o,g||null!=b.dangerouslySetInnerHTML),function(e,n,t){var o;for(o in t)n&&null!=n[o]||null==t[o]||f(e,o,t[o],t[o]=void 0,v);for(o in n)"children"===o||"innerHTML"===o||o in t&&n[o]===("value"===o||"checked"===o?e[o]:t[o])||f(e,o,t[o],t[o]=n[o],v)}(i,n.attributes,b),v=s,i}function k(e,n){var t=e._component;t?O(t):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==n&&null!=e.__preactattr_||d(e),w(e))}function w(e){for(e=e.lastChild;e;){var n=e.previousSibling;k(e,!0),e=n}}var C={};function N(e,n,t){var o,r=C[e.name];if(e.prototype&&e.prototype.render?(o=new e(n,t),j.call(o,n,t)):((o=new j(n,t)).constructor=e,o.render=S),r)for(var i=r.length;i--;)if(r[i].constructor===e){o.nextBase=r[i].nextBase,r.splice(i,1);break}return o}function S(e,n,t){return this.constructor(e,t)}function P(n,t,o,r,i){n._disable||(n._disable=!0,(n.__ref=t.ref)&&delete t.ref,(n.__key=t.key)&&delete t.key,!n.base||i?n.componentWillMount&&n.componentWillMount():n.componentWillReceiveProps&&n.componentWillReceiveProps(t,r),r&&r!==n.context&&(n.prevContext||(n.prevContext=n.context),n.context=r),n.prevProps||(n.prevProps=n.props),n.props=t,n._disable=!1,0!==o&&(1!==o&&!1===e.syncComponentUpdates&&n.base?l(n):T(n,1,i)),n.__ref&&n.__ref(n))}function T(n,t,o,i){if(!n._disable){var s,a,l,u=n.props,c=n.state,d=n.context,f=n.prevProps||u,m=n.prevState||c,v=n.prevContext||d,g=n.base,x=n.nextBase,w=g||x,C=n._component,S=!1;if(g&&(n.props=f,n.state=m,n.context=v,2!==t&&n.shouldComponentUpdate&&!1===n.shouldComponentUpdate(u,c,d)?S=!0:n.componentWillUpdate&&n.componentWillUpdate(u,c,d),n.props=u,n.state=c,n.context=d),n.prevProps=n.prevState=n.prevContext=n.nextBase=null,n._dirty=!1,!S){s=n.render(u,c,d),n.getChildContext&&(d=r(r({},d),n.getChildContext()));var j,E,U=s&&s.nodeName;if("function"==typeof U){var z=p(s);(a=C)&&a.constructor===U&&z.key==a.__key?P(a,z,1,d,!1):(j=a,n._component=a=N(U,z,d),a.nextBase=a.nextBase||x,a._parentComponent=n,P(a,z,0,d,!1),T(a,1,o,!0)),E=a.base}else l=w,(j=C)&&(l=n._component=null),(w||1===t)&&(l&&(l._component=null),E=y(l,s,d,o||!g,w&&w.parentNode,!0));if(w&&E!==w&&a!==C){var L=w.parentNode;L&&E!==L&&(L.replaceChild(E,w),j||(w._component=null,k(w,!1)))}if(j&&O(j),n.base=E,E&&!i){for(var A=n,$=n;$=$._parentComponent;)(A=$).base=E;E._component=A,E._componentConstructor=A.constructor}}if(!g||o?b.unshift(n):S||(n.componentDidUpdate&&n.componentDidUpdate(f,m,v),e.afterUpdate&&e.afterUpdate(n)),null!=n._renderCallbacks)for(;n._renderCallbacks.length;)n._renderCallbacks.pop().call(n);h||i||_()}}function O(n){e.beforeUnmount&&e.beforeUnmount(n);var t=n.base;n._disable=!0,n.componentWillUnmount&&n.componentWillUnmount(),n.base=null;var o=n._component;o?O(o):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),n.nextBase=t,d(t),function(e){var n=e.constructor.name;(C[n]||(C[n]=[])).push(e)}(n),w(t)),n.__ref&&n.__ref(null)}function j(e,n){this._dirty=!0,this.context=n,this.props=e,this.state=this.state||{}}function E(e,n,t){return y(t,e,{},!1,n,!1)}r(j.prototype,{setState:function(e,n){var t=this.state;this.prevState||(this.prevState=r({},t)),r(t,"function"==typeof e?e(t,this.props):e),n&&(this._renderCallbacks=this._renderCallbacks||[]).push(n),l(this)},forceUpdate:function(e){e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),T(this,2)},render:function(){}});var U={command:"mute"};var z={command:"afk"};var L={command:"snooze"};var A={command:"unmute"};var M="https://api.dubtrack.fm/playlist";var B={fetch:function(){return new Promise(function(e,n){$.getJSON(M).fail(function(){n("error fetching playlists")}).done(function(t){t&&Array.isArray(t.data)?e(t.data):n("error fetching playlists")})})},add:function(e,n,t,o){var r=M+"/"+t+"/songs";return new Promise(function(t,i){$.post(r,{songid:o}).done(function(){t(e+" added to playlist "+n)}).fail(function(e){i("error saving to playlist")})})}},D={},I=null;B.fetch().then(function(e){e.length,e.forEach(function(e){D[e.name]=e})}).catch(function(e){console.error(e)}),Dubtrack.room.player.activeSong.fetch().done(function(e){I=e.data}),Dubtrack.Events.on("realtime:room_playlist-update",function(e){I=e});var W={command:"grab"};var F={command:"playlists"};var V={mute:function(){var e=$(".mute"),n={};return e.hasClass("sound-muted")?(e.trigger("click"),n.success="mute OFF"):(e.trigger("click"),n.success="mute ON"),Promise.resolve(Object.assign({},U,n))},afk:function(e){return new Promise(function(n,t){dubplus||t("Dub+ extension not found. Please install it: https://dub.plus");var o={};if(e&&e.length>0)$("#dubplus-afk .extra-icon").trigger("click"),$(".dp-modal textarea").val(e.join(" ")),setTimeout(function(){$("#dp-modal-confirm").trigger("click")},500),o.success="new AFK message saved";else{var r=document.querySelector("#dubplus-afk.dubplus-switch-on"),i=dubplus["dubplus-afk"];r?(i.turnOff(),i.toggleAndSave("dubplus-afk",!1),o.success="AFK mode off"):(i.turnOn(),i.toggleAndSave("dubplus-afk",!0),o.success="AFK mode on")}n(Object.assign({},z,o))})},snooze:function(){var e=$(".snooze_btn"),n={};return $(".mute").hasClass("sound-muted")?n.warning="mute is already on. if you did not turn it on via snooze, unmute before snoozing":(e.trigger("click"),n.success="snooze current song ON"),Promise.resolve(Object.assign({},L,n))},unmute:function(){var e=$(".mute"),n={};return new Promise(function(t,o){e.hasClass("sound-muted")?(e.trigger("click"),n.success="mute OFF",t(Object.assign({},A,n))):o("mute is not on")})},grab:function(e){var n={};if(!e)return Promise.reject("you must specify a playlist name");var t=e.join(" ").trim();if(D[t]){var o=D[t]._id,r=I.songInfo._id,i=I.songInfo.name;return new Promise(function(e,s){B.add(i,t,o,r).then(function(t){n.success=t,e(Object.assign({},W,n))}).catch(function(e){s(e)})})}return Promise.reject("playlist "+t+" does not exist")},playlists:function(){return new Promise(function(e,n){B.fetch().then(function(n){var t=n.map(function(e){return e.name});console.log(t),e(Object.assign({},F,{success:t.join(", ")}))}).catch(function(e){n(e)})})}},H=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},K=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),R=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n};function q(e){return e.error?o("p",{className:"dubterm-results__error"},e.error):e.success?o("p",{className:"dubterm-results__success"},e.success):e.info?o("p",{className:"dubterm-results__info"},e.info):e.warning?o("p",{className:"dubterm-results__warning"},e.warning):null}E(o("style",{id:"dub-terminal-css"},'.dubterm-container {\n  position: fixed;\n  left: 0;\n  bottom: 56px;\n  bottom: 3.6rem;\n  z-index: 18;\n  width: 500px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n  color: #839496;\n  -webkit-transition: -webkit-transform 0.3s;\n  transition: -webkit-transform 0.3s;\n  transition: transform 0.3s;\n  transition: transform 0.3s, -webkit-transform 0.3s;\n  -webkit-transform: translate(-460px, 0);\n          transform: translate(-460px, 0);\n  height: 80px; }\n\n.dubterm-open {\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0); }\n\n.dubterm-toggle {\n  width: 50px;\n  height: 40px;\n  border: none;\n  background-color: #000;\n  cursor: pointer;\n  -ms-flex-item-align: end;\n      align-self: flex-end; }\n\n.dubterm-main {\n  -webkit-box-flex: 1;\n      -ms-flex: 1 0 auto;\n          flex: 1 0 auto;\n  background-color: #002b36;\n  font-family: Consolas, monaco, monospace, "Courier New";\n  font-size: 13px; }\n\n.dubterm-results {\n  padding: 11px 18px;\n  background-color: #073642;\n  min-height: 40px;\n  max-height: 40px;\n  -webkit-transition: max-height 0.3s;\n  transition: max-height 0.3s;\n  overflow: hidden;\n  overflow-y: auto;\n  border-top: 1px solid #93a1a1;\n  border-right: 1px solid #93a1a1;\n  border-bottom: 1px solid #93a1a1; }\n  .dubterm-results.dubterm-expand {\n    max-height: auto; }\n  .dubterm-results p {\n    margin: 0; }\n\n.dubterm-results__error {\n  color: #dc322f; }\n\n.dubterm-results__success {\n  color: #2aa198; }\n\n.dubterm-results__warning {\n  color: #b58900; }\n\n/* The input container */\n.dubterm-input-c {\n  position: relative;\n  width: 100%;\n  height: 40px; }\n\n.dubterm-input-c span {\n  position: absolute;\n  width: 10px;\n  left: 10px;\n  top: 10px;\n  display: block;\n  height: 100%; }\n\n.dubterm-input-c input {\n  border: none;\n  width: 100%;\n  height: 100%;\n  background-color: black;\n  color: #ccc;\n  font-family: Consolas, monaco, monospace, "Courier New";\n  font-size: 13px;\n  padding: 0 0 0 20px; }\n'),document.querySelector("head")),E(o(function(e){function n(){H(this,n);var e=R(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.state={toggleCss:"dubterm-open",result:{info:"hi "+Dubtrack.session.get("username")}},e.toggleTerminal=e.toggleTerminal.bind(e),e.checkInput=e.checkInput.bind(e),e.onTransitionEnd=e.onTransitionEnd.bind(e),e}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,j),K(n,[{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.setState({toggleCss:""})},1500)}},{key:"onTransitionEnd",value:function(e){this.container.style.bottom=$("#player-controller").height()+"px"}},{key:"toggleTerminal",value:function(e){"dubterm-open"===this.state.toggleCss?this.setState({toggleCss:""}):this.setState({toggleCss:"dubterm-open"})}},{key:"parseInput",value:function(e){var n=e.split(" "),t=n.shift();return V[t]?V[t](n):Promise.reject(t+" is not a recognized command")}},{key:"checkInput",value:function(e){var n=this;if(13===e.keyCode){if(e.preventDefault(),""===e.target.value)return;this.results.classList.remove("dubterm-expand"),this.parseInput(e.target.value).then(function(e){console.log(e),n.setState({result:e}),n.results.classList.add("dubterm-expand")}).catch(function(e){n.setState({result:{error:e}})}),e.target.value=""}}},{key:"render",value:function(e,n){var t=this;return o("div",{id:"dub-terminal",className:("dubterm-container "+n.toggleCss).trim(),ref:function(e){return t.container=e}},o("div",{className:"dubterm-main"},o("div",{className:"dubterm-results",ref:function(e){return t.results=e},onTransitionEnd:this.onTransitionEnd},o(q,n.result)),o("div",{className:"dubterm-input-c"},o("input",{onKeyUp:this.checkInput,type:"text",id:"dubterm-input"}),o("span",null,">"))),o("button",{onClick:this.toggleTerminal,className:"dubterm-toggle"},o("span",null,">_")))}}]),n}(),null),document.body)}();
//# sourceMappingURL=dub-terminal.js.map
